---
title: label で input[type="file"] を装飾するな
emoji: "📄"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["アクセシビリティ", "html"]
published: true
---

`input[type="file"]` な要素を装飾する方法を検索したときに、次のような `label` 要素を使う方法ばかりヒットするのが気になったので書きました。

```html
<label>
  ファイルを選択
  <input type="file" />
</label>
```

```css
label {
  /* 装飾 */
}

input {
  display: none;
}
```

## 何が問題か

上記の方法は `input` 要素を `display: none` で非表示にし、`label` 要素を使ってヒット領域を拡大させて「ファイルを選択」ボタンを表現するという方法ですが、この方法では**フォーカスが当たりません**。また、`tabindex` 属性に非負の値を設定しフォーカスを当てられるようにしても `label` は clickable な要素ではないので **Space / Enter キーで click イベントを発火することができません**。

## どうするべきか

`button` 要素を使い、クリック時に `input` 要素の click イベントを発火させましょう。`input` 要素の代わりに [File System Access API](https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API) を使う方法もありますが、執筆時点では対応していないブラウザがあるので使わないほうが無難です。

<!-- prettier-ignore -->
```html
<button>ファイルを選択</button>
<input type="file" />
```

```js
document.querySelector("button").addEventListener("click", () => {
  document.querySelector("input").click();
});
```

```css
button {
  /* 装飾 */
}

input {
  display: none;
}
```

`button` 要素を使うのが適切でない場合は、次のようにアクセシビリティに配慮したボタンを作りましょう。

```html
<div role="button" tabindex="0">ファイルを選択</div>
<input type="file" />
```

```js
const buttonElement = document.querySelector("div");

buttonElement.addEventListener("click", () => {
  document.querySelector("input").click();
});

// Space / Enter キーで click イベントを発火できるようにする
buttonElement.addEventListener("keydown", (event) => {
  if (!buttonElement.isEqualNode(event.target)) {
    return;
  }

  if (event.keyCode === 32 || event.keyCode === 13) {
    event.preventDefault();
    document.querySelector("input").click();
  }
});
```

```css
div {
  /* 装飾 */
}

input {
  display: none;
}
```

## 参考

- [WAI-ARIA Authoring Practices 1.2](https://www.w3.org/TR/wai-aria-practices/#button)
- [react-dropzone](https://github.com/react-dropzone/react-dropzone)
